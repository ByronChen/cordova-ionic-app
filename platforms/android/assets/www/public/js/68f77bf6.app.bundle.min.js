var Utils=function(){var a=function(a){window.plugins&&window.plugins.toast&&window.plugins.toast.showShortBottom(a)},b=function(a){return angular.element(document.getElementById(a))};return{toast:a,getElementById:b}}(),zlzapp=angular.module("jdxtapp",["ionic"]);zlzapp.run(["$ionicPlatform","$ionicLoading",function(a){a.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.StatusBar&&StatusBar.styleDefault(),navigator.splashscreen&&navigator.splashscreen.hide()})}]),zlzapp.config(["$stateProvider","$urlRouterProvider",function(a,b){a.state("app",{url:"/app","abstract":!0,templateUrl:"views/menu.html",controller:"AppCtrl"}).state("app.map",{url:"/map",views:{menuContent:{templateUrl:"views/map.html",controller:"MapCtrl"}}}).state("app.search",{url:"/search",views:{menuContent:{templateUrl:"views/search.html",controller:"SearchCtrl"}}}).state("app.playlists",{url:"/playlists",views:{menuContent:{templateUrl:"views/playlists.html",controller:"PlaylistsCtrl"}}}).state("app.single",{url:"/playlists/:playlistId",views:{menuContent:{templateUrl:"views/playlist.html",controller:"PlaylistCtrl"}}}),b.otherwise("/app/map")}]),zlzapp.directive("zlzImgSrc",[function(){var a=function(a,b,c){c.$observe("zlzImgSrc",function(a){if(a){var b=a.split(",");2==b.length&&c.$set("src",b[0]+"_"+b[1]+b[0].substr(b[0].lastIndexOf(".")))}})};return{link:a}}]),zlzapp.controller("AppCtrl",["$scope","$ionicModal","$timeout",function(a,b,c){a.loginData={},b.fromTemplateUrl("views/login.html",{scope:a}).then(function(b){a.modal=b}),a.closeLogin=function(){a.modal.hide()},a.login=function(){a.modal.show()},a.doLogin=function(){console.log("Doing login",a.loginData),c(function(){a.closeLogin()},1e3)}}]),zlzapp.controller("MapCtrl",["$scope","Map","GCZ",function(a,b,c){var d=document.getElementById("bmap"),e=d.parentNode.parentNode.clientHeight;d.style.height=e+"px",b.createMap("bmap"),b.getLocation(),a.getLocation=b.getLocation,b.autoAddMarkers(c.listAll()),b.addPolyLine(),a.searchGcz=function(){a.isHideSearchBox=0,a.gczList=c.list(a.keyword)},a.selectGcz=function(a){alert(a)},window.addEventListener("native.keyboardhide",function(){document.getElementById("search-input").blur()})}]),zlzapp.controller("SearchCtrl",["$scope","Video",function(a,b){a.videoList=b.listAll()}]),zlzapp.factory("Map",["$filter",function(a){window.map=null,window.locationMarker=null;var b=[{code:2,msg:"位置结果未知"},{code:3,msg:"导航结果未知"},{code:4,msg:"非法密钥"},{code:5,msg:"非法请求"},{code:6,msg:"没有权限"},{code:7,msg:"服务不可用"},{code:8,msg:"超时"}],c=function(a){window.map=new BMap.Map(a);var b={features:["road","building","water","land"]};map.setMapStyle(b),map.centerAndZoom(new BMap.Point(120.161308,30.280454),14),map.addControl(new BMap.NavigationControl)},d=function(){Utils.toast("正在定位...");var c=new BMap.Geolocation;c.getCurrentPosition(function(d){if(c.getStatus()==BMAP_STATUS_SUCCESS)locationMarker&&map.removeOverlay(locationMarker),map.panTo(d.point),window.locationMarker=e(d.point);else{var f=a("filter")(b,{code:c.getStatus()});alert("定位失败,请重试!Error:"+f[0].msg)}},{enableHighAccuracy:!0})},e=function(a,b){var c="public/images/icon/";b||(b="pin@32x32.png");var d=/@([0-9]+)x([0-9]+)/.exec(b),e=new BMap.Icon(c+b,new BMap.Size(d[1],d[2]),{anchor:new BMap.Size(d[1]/2,d[2])}),f=new BMap.Marker(a,{icon:e});return map.addOverlay(f),f},f=function(a){angular.forEach(a,function(a){e(new BMap.Point(a.longitude,a.latitude),"marker1@26x38.png")})},g=function(a,b,c){if(b=b?b:"#00ff00",c=c?c:3,angular.isArray(a)){var d=new BMap.Polyline(a,{strokeColor:b,strokeWeight:c,strokeOpacity:.5});map.addOverlay(d)}};return{createMap:function(a){c(a)},getLocation:function(){d()},addMarker:function(a,b){return e(a,b)},autoAddMarkers:function(a){f(a)},addPolyLine:function(a,b,c){g(a,b,c)}}}]),zlzapp.factory("GCZ",["$filter",function(a){var b=[{id:1,road:"G25",name:"南庄兜(獐山)拥堵点",longitude:120.089244,latitude:30.466947},{id:3,road:"G2501",name:"勾庄",longitude:120.078294,latitude:30.367116},{id:4,road:"G2501",name:"红垦拥堵点",longitude:120.370644,latitude:30.240671},{id:5,road:"G2501",name:"三墩",longitude:120.058874,latitude:30.298743},{id:6,road:"G2501",name:"三墩拥堵点",longitude:120.064191,latitude:30.307905},{id:7,road:"G2501",name:"下沙",longitude:120.376185,latitude:30.3236},{id:8,road:"G2501",name:"杨汛桥",longitude:120.309023,latitude:30.123758}];return{listAll:function(){return b},list:function(c){return c?a("filter")(b,c):[]}}}]),zlzapp.factory("JTLL",["$filter",function(a){var b=[{id:1,road:"G25",name:"南庄兜(獐山)拥堵点",longitude:120.089244,latitude:30.466947},{id:3,road:"G2501",name:"勾庄",longitude:120.078294,latitude:30.367116},{id:4,road:"G2501",name:"红垦拥堵点",longitude:120.370644,latitude:30.240671},{id:5,road:"G2501",name:"三墩",longitude:120.058874,latitude:30.298743},{id:6,road:"G2501",name:"三墩拥堵点",longitude:120.064191,latitude:30.307905},{id:7,road:"G2501",name:"下沙",longitude:120.376185,latitude:30.3236},{id:8,road:"G2501",name:"杨汛桥",longitude:120.309023,latitude:30.123758}];return{listAll:function(){return b},list:function(c){return c?a("filter")(b,c):[]}}}]),zlzapp.factory("Video",["$http",function(a){var b=[];return a({method:"GET",url:"http://api.xpker.com:80/video/list?appKey=10000001&page=1&rows=5&timestamp=1404974165&sign=9b10fd9d37bbd3ae57e4b5940512e362"}).success(function(a){b=a.data,console.log(b)}).error(function(a,b,c){console.log("error:"+a+":"+b+":"+c)}),{listAll:function(){return b}}}]);